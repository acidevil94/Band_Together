
<div class="row">
  <h1 align="center" style= "margin-bottom: 30px">Sign up</h1>
  <div class="col-md-4 col-md-offset-4" align="center" style= "margin-bottom: 30px">
    <div class="oauth" style="text-align: center;" >
      <%= button_to user_google_oauth2_omniauth_authorize_path, :class => "btn btn-danger btn-social btn-google" ,:style =>"margin-right: 10px;" do %>
      <span class="fa fa-google"></span> Sign in with Google
      <%end%>
     or
      <%= button_to user_facebook_omniauth_authorize_path, :class => "btn btn-primary btn-social-icon btn-facebook" ,:style =>"margin-left: 10px;" do %>
      <span class="fa fa-facebook"></span> Sign in with Facebook
      <%end%>
    </div>
  </div>
<div class="col-md-4 col-md-offset-4 ">

  <%= form_for(resource, as: resource_name, url: registration_path(resource_name)) do |f| %>
    <%= devise_error_messages! %>

    <div class="field">
      <%= f.label :username %>
      <%= f.text_field :username, autofocus: true, class: 'form-control' %>
    </div>
<br />
    <div class="field">
      <%= f.label :email %>
      <%= f.email_field :email , class: 'form-control' %>
    </div>
<br />
    <div class="field">
      <%= f.label :password %>
      <% if @minimum_password_length %>
      <em>(<%= @minimum_password_length %> characters minimum)</em>
      <% end %>
      <%= f.password_field :password, autocomplete: "off", class: 'form-control'  %>
    </div>
<br />
    <div class="field">
      <%= f.label :password_confirmation %>
      <%= f.password_field :password_confirmation, autocomplete: "off", class: 'form-control'  %>
    </div>
<br />
    <div class="field">
      <%= f.label :first_name , "First name"%>
      <%= f.text_field :first_name , class: 'form-control' %>
    </div>
<br />
    <div class="field">
      <%= f.label :last_name , "Last name"%>
      <%= f.text_field :last_name , class: 'form-control' %>
    </div>
<br />

  <div class="field">
    <%= f.label :gender, "Gender"%>
    <%= f.select(:gender, options_for_select([["Male","M"],["Female","F"]] ), {}, {:class => 'form-control'})  %>

    </div>
<br />
    <div class="field">
      <%= f.label :birth , "Birth date"%>
      <%= f.text_field :birth, "data-provide" => 'datepicker' , class: 'form-control' %>
    </div>



    <br>

  <!--

      I campi della nazione e della regione sono stati modificati e sono diventati delle select. Il campo della regione si basa sul valore scelto
      dall'utente nel campo nazione per mostreare le regioni della nazione scelta

      RezeR
  -->

  <div class="field">
    <%= f.hidden_field :nation %>
    <%= f.hidden_field :region %>
    <%= f.hidden_field :city %>
  </div>


    <div class="field">
      <%= f.label :nation , "Nation"%>
      <select id="countries" name="nation" class="form-control">
        <option value="" selected="">Select country</option>}
        <% CS.countries.each do |key, value| %>
        <option value="<%= key %>"><%= value %></option>
        <% end %>
      </select>

      <br/>

  <%= f.label :region , "Region"%>
      <select name="region" id="states-of-country" class="form-control">
        <option value="" selected="">Select state/province</option>
      </select>

<br/>
  <%= f.label :city , "City"%>
  <select name="city" id="city-of-region" class="form-control">
    <option value="" selected="">Select City</option>
  </select>


      <script>


      //Andrea. ho scelto di usare il trigger dell'evento di change della select dipendente da quella che si cambia, così
        //      ad ogni cambio di select a monte corrisponde un cambio a valle, eliminando il trigger non funzionava.

       // al cambio di nazione
        $('#countries').change(function(){
          $("#user_nation").val($(this).find(":selected").text()); //Setta il value del campo hidden nation al valore selezionato nella select "nation"

          //interroga la gemma per prendere le regioni corrispondenti
          $.getJSON('/states/' + $(this).val() , function(data){
            $('#states-of-country').empty();
            $('#city-of-region').empty();
            $.each(data, function(k, ele){
              var opt = '<option value='+ k +'>' + ele + '</option>';
              $('#states-of-country').append(opt);
            });

          //$("#user_region").val($('#states-of-country').find(":selected").text()); //Setta il value del campo hidden region al primo valore selezionato nella select "region"
          $("#states-of-country").trigger('change');
          });
        });


        // al cambio di regione
        $('#states-of-country').change(function(){
          $("#user_region").val($(this).find(":selected").text());

          //interroga la gemma per prendere le città corrispondenti
          $.getJSON('/states/' + $('#countries').val()  + '/' +  $(this).val() , function(data){
            $('#city-of-region').empty();
            $.each(data, function(k, ele){
              var opt = '<option value='+ k +'>' + ele + '</option>';
              $('#city-of-region').append(opt);
            });
          //$("#user_city").val($(this).find(":selected").text());
          $("#city-of-region").trigger('change');
        });
      });

        //al cambio di città
        $('#city-of-region').change(function(){
          $("#user_city").val($(this).find(":selected").text());
        });
      </script>





    </div>


    <br>

    <!--
    I campi hidden "nation" e "region" e "city" servono per salvare i valori della nazione e della regione e della città selezioni e che verranno passati alla POST.
    RezeR
    -->



    <div class="field">
      <%= f.label :type_of_musician, "Instrument played" %>

      <%= f.select(:type_of_musician, options_for_select(["Drummer", ["Lead Guitar", "Lead_guitarist"], ["Rhythm Guitar", "Rhythmic_guitarist"], ["Bass", "Bass_guitarist"], "Keyboardist", "Singer", "Winds"] ), {}, {:class => 'form-control'})  %>

    </div>

    <br>

    <div class="field">
      <%= f.label :musical_genre, "Favourite musical genre" %>
      <%= f.select(:musical_genre, options_for_select(["Rock", "Metal", "Jazz", "Blues", "Pop", "Classic", "Latin"] ), {}, {:class => 'form-control'})  %>

    </div>

    <br>

    <div class="actions" align="center">
      <%= f.submit "Sign up", :id => "SignUp" ,:class => "btn btn-primary btn-lg"%>
    </div>
    <% end %>
<br/>

</div>

</div>
